//the node-fetch api
// const fetch = require("node-fetch");

// Require the Aylien npm package
const aylienAPI = require("aylien_textapi");

const aylien = new aylienAPI({
  application_id: process.env.API_ID,
  application_key: process.env.API_KEY,
});

function getAylienAnalysis(req) {
  let data = {
    endpoint: [
      "sentiment",
      "extract",
      "summarize",
      "concepts",
      "entities",
      "language",
      "hashtags",
      "classify",
    ],
  };
  // check for url or text input
  if (req.textTest) {
    data.text = req.textTest;
  } else {
    data.url = req.urlTest;
  }

  let analysisResult;
  aylien.combined(data, async function (err, result) {
    if (err === null) {
      // result.results.forEach(function (r) {
      //   console.log("\n--------\n", r.endpoint + ":");
      //   console.log(r.result, "\n--------\n");
      // });
      let convert = await JSON.stringify(result.results);
      
      analysisResult =  convert;
      // console.log(result);
    } else {
      console.log(err);
    }
  });
  console.log(analysisResult);
  return analysisResult;
}

module.exports = getAylienAnalysis;

let urlTest =
  "https://www.woodsbagot.com/news/woods-bagots-facade-automation-workflow-named-a-finalist-in-fast-companys-2019-innovation-by-design-awards/";
